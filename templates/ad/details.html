{% extends 'layout/base.html' %}
{% load bootstrap3 %}
{% load thumbnail %}
{% load comments %}
{% load common_tags %}
{% block title %}Aviso {{ ad.title }}{% endblock %}

{% block js_header_block %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/cloud-zoom.js"></script>
{% endblock %}

{% block css_header_block %}
    <link rel="stylesheet" href="{{ STATIC_URL }}css/less/ad-detail.css" >
    <link rel="stylesheet" href="{{ STATIC_URL }}css/cloud-zoom.css" type="text/css">
{% endblock %}

{% block body_block %}
    <div class="ad-detail-page">
    {% bootstrap_messages %}
    <div class="section summery">
        <!-- Thumnails -->
        <div class="col-md-1 col-md-offset-1">
            {% for images in ad.images.all %}
                {% thumbnail images.image "800x800" crop="center" as im %}
                    <a id="{{ images.pk }}" class="ad-image-gallery" data-image="{{ im.url }}">
                {% endthumbnail %}
            {% thumbnail images.image "100x100" crop="center" as im %}
                <img class="img-thumbnail" src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">
            {% endthumbnail %}
            </a>
            {% endfor %}
        </div>
        <!-- Main Image -->
        <div class="col-md-4" >
            {% with ad.images.all|first as image %}
                {% thumbnail image.image "800x800" crop="center" as im %}
                    <!-- TODO: make cloud zoom responsive -->
                    <a id="main-image-link" href="{{ im.url }}" class="cloud-zoom" rel=" adjustY:0, adjustX:30, zoomWidth:535 ">
                        <img id="main-image" class="img-thumbnail" src="{{ im.url }}">
                    </a>
                {% endthumbnail %}
            {% endwith %}
        </div>
        <!-- Ad Summery -->
        <div class="col-md-5">
            <h1 class=" product title">{{  ad.title }}</h1 >
            <div class="product price pull-right">${{ ad.price|floatformat:"0" }}<sup>{{ ad.price|float_decimal_part}}</sup></div>
            <div class="product desc">{{ ad.short_description }}</div>

            <div class="publisher">
                <div class="ratting">
                    <div >Puntaje de este Anunciante</div>
                    <div class="score">
                        <i class="rate-bar-green"></i>
                        <i class="rate-bar-green"></i>
                        <i class="rate-bar-green"></i>
                        <i class="rate-bar-light-orange"></i>
                        <i class="rate-bar-orange"></i>
                    </div>
                </div>

                <!-- ######## CONTACT ############# -->
                {% if user.is_authenticated %}
                    <!-- BUTTON OPEN --->
                    <button data-toggle="modal" class="btn btn-lg pull-right contact" id="btn-contact" data-target="#modalMessage">
                        <i class=""></i> Contactar
                    </button>
                {% else %}
                    <a class="contact btn btn-lg btn-success pull-right" href="/accounts/login/?next=/ad/{{ ad.slug }}">
                        <i class=""></i> Contactar
                    </a>
                {% endif %}
                <!-- /.modal compose message -->
                <div class="modal" id="modalMessage">
                </div>
                <!-- ######## END CONTACT ############# -->
                <div class="social">
                    <a class="popup" href="http://twitter.com/share"><i class="twitter pull-right"></i></a>
                    <a class="popup" href="https://www.facebook.com/sharer/sharer.php?app_id=1507071816215188&amp;u={{ request.get_full_path|urlencode }}&amp;display=popup&amp;ref=plugin"><i id="social" class="facebook pull-right"></i></a>
                </div>
            </div>
        </div>
    </div>

    <!-- Ad Details -->
    <div class="section">
        <div class="container col-md-10 col-md-offset-1">
            <div class="panel panel-default widget">
                <div class="panel-heading">
                    Descripcion del Anuncio
                </div>
                <div class="panel-body" >
                    {{ ad.body|safe }}
                </div>
            </div>
        </div>
    </div>

    <!-- Listado de Comentarios / Preguntas -->
    {% get_comment_count for object as comment_count %}
    <!-- Comments  List -->
    <div class="section">
    <div class="container col-md-10 col-md-offset-1">
    {% render_comment_list for object %}
    </div>
    </div>

    <!-- Comment Form -->
    <div class="section">
        {% if user.is_authenticated %}
            <span id="form-comment-list">
            <div class="comment-form container col-md-10 col-md-offset-1">
                <div class="panel panel-default widget">
        <div class="panel-heading">
            Ingresa tu Pregunta
        </div>
        <div class="panel-body">

                {% render_comment_form for ad %}
            </div>
                    </div>
                </div>
            </span>
            <script>
                var content_comment_form = $("#form-comment-list");
                submit_comment_ajax(content_comment_form);
            </script>
        {% else %}
            <div class="container col-md-10 col-md-offset-1">
                <a class="btn btn-success pull-right" href="/accounts/login/?next=/ad/{{ ad.slug }}">
                    <i class=""></i> Ingresar para Preguntar
                </a>

            </div>
        {% endif %}
    </div>
{% endblock %}

{% block js_footer_block %}
    <script>
        var ad = {id: {{ad.id}} };
    </script>

    <script type="text/javascript" src="{{ STATIC_URL }}js/ad/detail.js"></script>
{% endblock %}
</div>