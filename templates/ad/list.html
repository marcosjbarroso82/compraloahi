{% extends 'layout/base.html' %}
{% block title %}Lista de avisos {% endblock %}
{% load thumbnail %}
{% load common_tags %}
{% load staticfiles %}



{% block css_header_block %}
<link rel="stylesheet" type="text/css" href="{% static 'css/less/list-ad.css' %}">
{% endblock %}




{% block body_block %}

<div id="page-ads-list" class="ad-list" ng-app="App" ng-controller="AdCtrl">
    
    <!-- ########################## MAP ########################## -->
    {% verbatim %}
        <div class="angular-google-map-container" id="map-container">
            <ui-gmap-google-map id="mapa"
                                center="map.center"
                                zoom="map.zoom"
                                draggable="true"
                                options="map.options"
                                control="map.control"
                                panControl="true"
                                zoomControl="true">
                <!-- Search Location -->
                <ui-gmap-circle ng-repeat="ad in ads track by ad.pk"
                                center="search_location.location"
                                stroke="search_location.stroke"
                                fill="search_location.fill"
                                radius="search_location.radius"
                                visible="true"
                                geodesic="location_options.geodesic"
                                editable="true"
                                draggable="true"
                                clickable="false">
                </ui-gmap-circle>
                <!-- Ad Locations -->
                <ui-gmap-circle ng-repeat="ad in ads track by ad.pk"
                                center="ad.center"
                                stroke="ad.stroke"
                                fill="ad.fill"
                                radius="ad.radius"
                                visible="true"
                                geodesic="location_options.geodesic"
                                editable="location_options.editable"
                                draggable="location_options.draggable"
                                clickable="location_options.clickable"
                                events="circle_events">
                </ui-gmap-circle>
            </ui-gmap-google-map>

        </div>
    <!-- ########################## END MAP ########################## -->
    {% endverbatim %}

    <!-- ########################## SECTION DATA FILTER MAP ########################## -->
    <section id="data-filter-map" class="col-md-7">
             <!-- ########################## FORM LOCATION INF ########################## -->
        <div id="data-position-form" class="col-md-5">
            <!-- Address -->
            <div class="input-group col-md-12">
                <div class="input-group-custom-addon icon-addon addon-sm">
                    <input type="text" placeholder="Ingresa tu ubicacion" class="form-control" id="search_address_btn">
                    <button id="search_address_btn" class="glyphicon glyphicon-search" rel="tooltip" title="Busca en tu ubicacion" type="submit"></button>
                </div>
            </div>

            <!-- Radius -->
            <div class="">
                {% verbatim %}

                <div class="range range-success">
                    <input id="map_radius" class="col-md-8" type="range" name="map_radius" min="1000" max="10000" ng-model="search_location.radius" >
                </div>
                <div class="form-inline pull-right">
                    <label class="label-dist" for="range">Distancia :</label>

                    <output id="range" class="form-control">{{ search_location.radius }}</output>
                    <label class="label-dist">Mtrs</label>
                </div>
                {% endverbatim %}
            </div>

            {% if user.is_authenticated %}

                <!-- ########################## SAVE NEW LOCATION ########################## -->
                <button data-toggle="modal" class="btn" id="btn-new-location" data-target="#modalNewLocation" rel="tooltip" title="Guarda la ubicacion">
                    <i class="glyphicon glyphicon-floppy-disk"></i>
                </button>

                <!-- MODAL SAVE NEW LOCATION -->
                <div class="modal" id="modalNewLocation">

                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
                                <h4 class="modal-title">Guardar Ubicacion</h4>
                            </div>
                            <div class="modal-body">
                                {% verbatim %}
                                    <!-- Address -->
                                    <div class="form-group">
                                        <label>Nombre :</label>
                                        <input id="search_location_name"  class="form-control" type="text"
                                        placeholder="Ingrese el nombre de la ubicaciÃ³n"
                                        ng-model="search_location.title" />

                                    </div>
                                        
                                {% endverbatim %}
                            </div>
                            <div class="modal-footer">
                                <button ng-click="submitNewLocation()" type="submit" class="btn btn-primary pull-right">
                                        Guardar
                                </button>
                                <button data-dismiss="modal" class="btn btn-warning pull-right">
                                    Cancelar
                                </button>
                            </div>
                        </div>
                    </div>
                <!-- END MODAL SAVE NEW LOCATION -->
                </div>
                <!-- ########################## END SAVE NEW LOCATION ########################## -->




        <!-- ########################## END FORM LOCATION INF (IN ELSE TOO CLOSE) ########################## -->
        </div>


        

             <!-- ########################## MY LOCATIONS ########################## -->
            <button data-toggle="modal" class="btn btn-success" id="btn-my-locations" data-target="#modalSelectLocation" style="z-index: 99999;">
                <i class=""></i> Mis Ubicaciones
            </button>

            <!-- MODAL SELECT MY LOCATION -->
            <div class="modal" id="modalSelectLocation">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
                            <h4 class="modal-title">Elije una ubicacion</h4>
                        </div>
                        <div class="modal-body">
                            {% verbatim %}
                                <ul>
                                    <li ng-repeat="user_location in user_locations">
                                        <div class="radio">
                                          <label class="i-checks">
                                            <input name="selte" value="{{ user_location.title }}" type="radio">

                                            <i></i>
                                            {{ user_location.title }}
                                          </label>
                                        </div>
                                    </li>
                                </ul>
                                <!--
                                    <select id="user-locations-select" ng-model="user_location_selected" ng-options="user_location.title for user_location in user_locations">
                                                    <option selected value="">Elije un Ubicacion</option>
                                                </select>
                                -->

                            {% endverbatim %}
                        </div>
                        <div class="modal-footer">
                            <button ng-click="submitNewLocation()" type="submit" class="btn btn-primary pull-right">
                                    Aceptar
                            </button>
                            <button data-dismiss="modal" class="btn btn-warning pull-right">
                                    Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            <!-- END MODAL SELECT MY LOCATION -->
            </div>

            <!-- ########################## END MY LOCATIONS ########################## -->

        
        {% else %}
            <!-- ########################## END FORM LOCATION INF (IN IF TOO CLOSE) ########################## -->
            </div>
        {% endif %}


        <!-- ########################## BTN FILTER FACET ########################## -->
        <button data-toggle="modal" class="btn btn-success" id="btn-filter-facet" data-target="#modalFilterFacet">
            <i class=""></i> Filtros
        </button>

        <!-- ########################## MODAL FILTER FACET ########################## -->
        <div class="modal" id="modalFilterFacet">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
                        <h4 class="modal-title">Active filtros de busqueda</h4>
                    </div>
                    <div class="modal-body">
                            <!-- Categories -->
                            {% if facets.fields.categories %}
                                <h5>Categorias</h5>
                                <ul>
                                    {% for category in facets.fields.categories %}
                                        <li>
                                            {% with "categories_exact:"|add:category.0 as facet_value %}
                                                <a href="{% add_get page='1' %}&selected_facets={{ facet_value }}">
                                                {{ category.0 }}<span class="badge">{{ category.1 }}</span></a>
                                            {% endwith %}
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                            <!-- End Categories -->


                            <!-- Provinces -->
                            {% if facets.fields.provinces %}
                                <h5>Provincias</h5>
                                <ul>
                                    {% for province in facets.fields.provinces %}
                                        <li>
                                            {% with "provinces_exact:"|add:province.0 as facet_value %}
                                                <a href="{% add_get page='1' %}&selected_facets={{ facet_value }}">
                                                {{ province.0 }}<span class="badge">{{ province.1 }}</span></a>
                                            {% endwith %}
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                            <!-- End Provinces -->

                            <!-- Localities -->
                            {% if facets.fields.localities %}
                                <h5>Localidades</h5>
                                <ul>
                                    {% for locality in facets.fields.localities %}
                                        <li>
                                            {% with "localities_exact:"|add:locality.0 as facet_value %}
                                                <a href="{% add_get page='1'%}&selected_facets={{ facet_value }}">
                                                {{ locality.0 }}<span class="badge">{{ locality.1 }}</span></a>
                                            {% endwith %}
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                            <!-- End Localities -->


                    <!-- EMILINAR --->

                    <!-- Provinces -->
                            {% if facets.fields.provinces %}
                                <h5>Provincias</h5>
                                <ul>
                                    {% for province in facets.fields.provinces %}
                                        <li>
                                            {% with "provinces_exact:"|add:province.0 as facet_value %}
                                                <a href="{% add_get page='1' %}&selected_facets={{ facet_value }}">
                                                {{ province.0 }}<span class="badge">{{ province.1 }}</span></a>
                                            {% endwith %}
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                            <!-- End Provinces -->

                    <!-- Provinces -->
                            {% if facets.fields.provinces %}
                                <h5>Provincias</h5>
                                <ul>
                                    {% for province in facets.fields.provinces %}
                                        <li>
                                            {% with "provinces_exact:"|add:province.0 as facet_value %}
                                                <a href="{% add_get page='1' %}&selected_facets={{ facet_value }}">
                                                {{ province.0 }}<span class="badge">{{ province.1 }}</span></a>
                                            {% endwith %}
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                            <!-- End Provinces -->

                    <!-- Provinces -->
                            {% if facets.fields.provinces %}
                                <h5>Provincias</h5>
                                <ul>
                                    {% for province in facets.fields.provinces %}
                                        <li>
                                            {% with "provinces_exact:"|add:province.0 as facet_value %}
                                                <a href="{% add_get page='1' %}&selected_facets={{ facet_value }}">
                                                {{ province.0 }}<span class="badge">{{ province.1 }}</span></a>
                                            {% endwith %}
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                            <!-- End Provinces -->

                    <!-- Provinces -->
                            {% if facets.fields.provinces %}
                                <h5>Provincias</h5>
                                <ul>
                                    {% for province in facets.fields.provinces %}
                                        <li>
                                            {% with "provinces_exact:"|add:province.0 as facet_value %}
                                                <a href="{% add_get page='1' %}&selected_facets={{ facet_value }}">
                                                {{ province.0 }}<span class="badge">{{ province.1 }}</span></a>
                                            {% endwith %}
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                            <!-- End Provinces -->

                    <!-- Provinces -->
                            {% if facets.fields.provinces %}
                                <h5>Provincias</h5>
                                <ul>
                                    {% for province in facets.fields.provinces %}
                                        <li>
                                            {% with "provinces_exact:"|add:province.0 as facet_value %}
                                                <a href="{% add_get page='1' %}&selected_facets={{ facet_value }}">
                                                {{ province.0 }}<span class="badge">{{ province.1 }}</span></a>
                                            {% endwith %}
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                            <!-- End Provinces -->

                    <!-- Provinces -->
                            {% if facets.fields.provinces %}
                                <h5>Provincias</h5>
                                <ul>
                                    {% for province in facets.fields.provinces %}
                                        <li>
                                            {% with "provinces_exact:"|add:province.0 as facet_value %}
                                                <a href="{% add_get page='1' %}&selected_facets={{ facet_value }}">
                                                {{ province.0 }}<span class="badge">{{ province.1 }}</span></a>
                                            {% endwith %}
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                            <!-- End Provinces -->





                    <!-- END ELIMINAR -->








                        </div>
                </div>
            </div>
        <!-- ########################## END MODAL FILTER FACET ########################## -->
        </div>

        <!-- ########################## BTN FILTER FACET ########################## -->
        <ul id="list-filters-active">
            <li class="active-filter"><span>Cordoba </span> <span href="*"> x</span></li>
            <li class="active-filter"><span>Cordoba </span> <span href="*"> x</span></li>
        </ul>




    <!-- ########################## END SECTION DATA FILTER MAP ########################## -->
    </section>



    <!-- ########################## CONTAINER ADs LIST ########################## -->
    <div id="container-ad-list" class="col-md-5">
        <div id="header-list" class="col-md-12">
            <p>Mostrando 20 de 300 resultados.</p>
            <div class="form-inline order-by-container">
                <label for="order_by">Ordenar por</label>
                <select class="form-control">
                    <option></option>
                    <option>Precio</option>
                    <option>Titulo</option>

                </select>
            </div>
        </div>

        <!-- ##### FORMUARIO QUE VA EN EL HEADER -->
        <form method="get" action="/ad/ad-list/" class="search-form" hidden="true">
            <div class="">
                <!-- TAG -->
                <div class="input-group stylish-input-group">
                    <input id="q" class="form-control" name="q" type="text" placeholder="Search" value="{{ form.data.q }}"/>
                            <span class="input-group-addon">
                                <!-- SUBMIT -->
                                <button type="submit" style="border: none; width: 100%; ">
                                    <i class="glyphicon glyphicon-search"></i>
                                </button>
                            </span>
                </div>

                <div id="hidden-fields" class="hidden">
                    {% verbatim %}
                    <!-- LATITUDE -->
                    <div>
                        <label for="lat">lat</label>
                        <input id="lat" type="text" name="lat" ng-model="search_location.location.latitude"/>
                    </div>
                    <!-- LONGITUD -->
                    <div  >
                        <label for="lng">lng</label>
                        <input id="lng" type="text" name="lng" ng-model="search_location.location.longitude"/>
                    </div>
                    <!-- RADIO -->
                    <div>
                        <label for="radius">Radius</label>
                        <input id="radius" type="number" name="radius" ng-model="search_location.radius"/>
                    </div>
                    <div>
                        <label for="color">Color</label>
                        <input id="color" type="text"  ng-model="search_location.fill.color"/>
                    </div>
                    {% endverbatim %}
                </div>
            </div>
        </form>
        <!--## FORMULARIO QUE VA EN EL HEADER-->


        {% verbatim %}
            <div id="ad-list" class="col-md-12">
                <!-- ADs LIST -->
                <div class="col-md-12 item-ads-list"
                     ng-repeat="ad in ads"
                     ng-mouseenter="selectAd(ad)"
                     ng-mouseleave="deselectAd(ad)"
                     ng-class="{'ads-list-item-hover': ad.selected == true}">

                    <div class="col-md-3 container-img">
                            <img class="img-responsive" src="{{ ad.image }}">
                     </div>

                     <div class="col-md-8 container-text">
                         <a id="ad-anchor-{{ ad.pk }}"></a> <!-- This tag is used for animation, It could be replaced -->
                        <a href="/ad/{{ ad.slug }}" ><h4 >{{ ad.title }}</h4></a>
                        <small> Publicado el {{ ad.pub_date }} </small>
                        <p> {{ ad.short_description }} </p>
                        
                     </div>
                      <span class="price-ads-list pull-right">${{ ad.price }}<sup>99</sup></span>  
                     <a class="locate-it btn" ng-click="centerMap(ad.center)" ><img src="/static/image/icon-location-it.png"></a>
                </div>

            </div>
        {% endverbatim %}


        <!-- PAGINATION ADs LIST -->
        <div class="pagination pull-right" id="pagination">
            {% if paginator %}
            {% load i18n %}
            <div class="pagination">
                {% if page.has_previous %}
                <a href="{% add_get page=page.previous_page_number %}" class="prev">&lsaquo;&lsaquo; {% trans "previous" %}</a>
                {% else %}
                <span class="disabled prev">&lsaquo;&lsaquo; {% trans "previous" %}</span>
                {% endif %}
                <span> Page {{ page.number }} of {{ paginator.num_pages }}</span>
                {% if page.has_next %}
                <a href="{% add_get page=page.next_page_number %}" class="next">{% trans "next" %} &rsaquo;&rsaquo;</a>
                {% else %}
                <span class="disabled next">{% trans "next" %} &rsaquo;&rsaquo;</span>
                {% endif %}
            </div>
            {% endif %}
        <!-- PAGINATION ADs LIST -->
        </div>


    <!-- ########################## END CONTAINER ADs LIST ########################## -->
    </div>

<!-- END content -->
</div>




<!-- END BLOCK BODY -->
{% endblock %}






{% block js_footer_block %}
    <script>
        var csrf = "{{ csrf_token }}";
    </script>

    <!-- LOAD USER LOCATIONS -->
    <script>
        var user_locations = [
            {% for user_location in user_locations %}
                {% if not forloop.first %},{% endif %}
                {
                    pk:{{ user_location.pk }},
                    title:"{{ user_location.title }}",
                    latitude:{{ user_location.lat }},
                    longitude:{{ user_location.lng }},
                    radius:{{ user_location.radius }}
                }


            {% endfor %}

        ];
        console.log(user_locations);
    </script>
    <!-- END - LOAD USER LOCATIONS -->
    <!--  LOAD ADS DATA -->
    <script>
        // TODO: define a proper initialization
        var search_location = {
            radius: {{ form.data.radius | default:20000}},
            location: {
                latitude: {{ form.data.lat | default:"-31.4179952" }},
                longitude: {{ form.data.lng | default:"-64.1890513" }}
            }
        };

        var json_data = {
            "count": 9,
            "next": "http://127.0.0.1:8000/api/v1/ads/?page=2",
            "previous": null,
            'results':[
                {% for ad in page.object_list %}
                    {% if not forloop.first %},{% endif %}
                    {
                        selected: false,
                        title: "{{ ad.title }}",
                        slug: "{{ ad.slug }}",
                        id: "{{ ad.id }}",
                        pk: "{{ ad.pk }}",
                        pub_date: "{{ ad.pub_date }}",
                        lat: "{{ ad.location.x }}",
                        lng: "{{ ad.location.x }}",
                        price: "{{ ad.price }}",
                        radius: 2000,
                        short_description: "{{ ad.short_description }}",
                        center:{
                            latitude: {{ ad.location.y }},
                            longitude: {{ ad.location.x }}
                        },
                        {% with ad.image1 as image %}
                            {% thumbnail ad.image1 "110x110" crop="center" as im %}
                                image: "{{ im.url }}"
                            {% endthumbnail %}
                        {% endwith %}
                    }
                {% endfor %}
            ]}
    </script>
    <!--  END - LOAD ADS DATA -->

    <!-- ###################### IMPORT THIRD LIB ###################### -->
    <!-- angular resources -->
    <script type="text/javascript" src="{% static 'bower_components/angular/angular.js' %}"></script>
    <script type="text/javascript" src="{% static 'bower_components/angular-resource/angular-resource.js' %}"></script>
    <script type="text/javascript" src="{% static 'bower_components/angular-route/angular-route.js' %}"></script>
    <script type="text/javascript" src="{% static 'bower_components/angular-ui-router/release/angular-ui-router.js' %}"></script>
    <script type="text/javascript" src="{% static 'bower_components/angular-sanitize/angular-sanitize.js' %}"></script>
    <script type="text/javascript" src="{% static 'bower_components/angular-google-maps/dist/angular-google-maps.js' %}"></script>
    <script type="text/javascript" src="{% static 'bower_components/angular-bootstrap/ui-bootstrap.js' %}"></script>
    <script type="text/javascript" src="{% static 'bower_components/angular-bootstrap/ui-bootstrap-tpls.js' %}"></script>
    <!-- google mapp -->
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true&libraries=places&language=en-US"></script>
    <!-- Nose -->
    <script type="text/javascript" src="{% static 'bower_components/lodash/dist/lodash.js' %}"></script>
    <!-- ###################### END IMPORT ###################### -->

    <!-- ###################### angular-resources APP ###################### -->
    <script type="text/javascript" src="{% static 'app.js' %}"></script>
    <!-- ###################### END angular-resources APP ###################### -->

    <!-- ###################### angular-resources APP - MODULE UTILS ###################### -->
    <script type="text/javascript" src="{% static 'angular-resources/utils/util.module.js' %}"></script>
    <script type="text/javascript" src="{% static 'angular-resources/utils/directives/google-places.directive.js' %}"></script>
    <script type="text/javascript" src="{% static 'angular-resources/utils/directives/really-click.directive.js' %}"></script>
    <script type="text/javascript" src="{% static 'angular-resources/utils/services/snackbar.service.js' %}"></script>

    <script type="text/javascript" src="{% static 'angular-resources/utils/directives/upload-file-model.directive.js' %}"></script>
    <!-- ###################### END angular-resources APP - MODULE UTILS ###################### -->

    <!-- ###################### angular-resources APP - MODULE AD ###################### -->
    <script type="text/javascript" src="{% static 'angular-resources/ad/ad.module.js' %}"></script>
    <script type="text/javascript" src="{% static 'angular-resources/ad/services/ad.json-service.js' %}"></script>
    <script type="text/javascript" src="{% static 'angular-resources/ad/controllers/ad.controller.js' %}"></script>
    <!-- ###################### END angular-resources APP - MODULE AD ###################### -->


    <script>
        /* Calcula el alto de la pagina y se lo setea al mapa, restandole el alto del header) */
        $("#map-container").height(screen.height - 50);

        $(".modal-content").find(".modal-body").css('max-height', screen.height - 280 );

    </script>


{% endblock %}


























